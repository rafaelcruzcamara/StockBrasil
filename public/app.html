<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockBrasil - Gerenciamento de Estoque e Vendas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <link rel="shortcut icon" href="./images/StockBrasilPRO-removebg-preview.png">
</head>
<body>

  <div id="initial-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0A0D12; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s;">
    <div style="font-size: 3rem; color: #0A84FF; margin-bottom: 20px;"><i class="fas fa-cubes fa-bounce"></i></div>
    <h2 style="color: white; font-family: sans-serif; margin-bottom: 10px;">StockBrasil</h2>
    <div style="width: 300px; height: 6px; background: #222; border-radius: 3px; overflow: hidden;"><div id="loader-bar" style="width: 0%; height: 100%; background: #0A84FF; transition: width 0.3s ease;"></div></div>
    <div id="loader-text" style="color: #888; margin-top: 10px;">0%</div>
    <div id="loader-status" style="color: #555; margin-top: 5px;">Iniciando...</div>
</div>



    <div id="undo-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h3><i class="fas fa-history"></i> Refazer Ação</h3>
            <p>A ação **<span id="undo-action-type"></span>** sobre **<span id="undo-action-detail"></span>** foi selecionada.</p>
            <p style="font-weight: bold; margin: 15px 0; color: var(--color-accent-red);">⚠️ Esta é uma simulação. Em um sistema real, essa ação requer lógica complexa de transações e acesso de administrador.</p>
            <button class="submit-btn blue-btn" onclick="simulateUndoConfirmation()"><i class="fas fa-check-circle"></i> Simular Reversão</button>
            <button class="submit-btn delete-btn" onclick="document.getElementById('undo-modal').style.display='none';"><i class="fas fa-times-circle"></i> Cancelar</button>
        </div>
    </div>
    
<div class="sidebar" id="sidebar">
    


    <div class="sidebar-body">
        
      <div class="profile-menu-container">
    
   <div class="sidebar-profile-card" onclick="toggleSidebarProfileMenu(event)">
        <img src="images/default-avatar.png" id="sidebar-user-photo" alt="Perfil">
        <div class="sidebar-profile-info">
            <span id="sidebar-user-name">Carregando...</span>
            <small>Meu Perfil</small>
        </div>
        <i class="fas fa-chevron-down arrow-icon"></i>
    </div>

    <div id="sidebar-profile-dropdown" class="sidebar-dropdown">
        <a href="#" onclick="openProfileSettings()"><i class="fas fa-user-cog"></i> Editar</a>
        <a href="#" onclick="logout()" style="color: #ff453a;"><i class="fas fa-sign-out-alt"></i> Sair</a>
    </div>
</div>
        <hr class="sidebar-divider">

        <div class="nav-section-label">PRINCIPAL</div>
        <a href="#dashboard" class="nav-item active"><i class="fas fa-home"></i> <span>Dashboard</span></a>
        <a href="#vendas" class="nav-item"><i class="fas fa-cash-register"></i> <span>Ponto de Vendas</span></a>

        <a href="#produtos" class="nav-item"><i class="fas fa-box-open"></i> <span>Produtos & Estoque</span></a>
        <a href="#parceiros" class="nav-item"><i class="fas fa-users"></i> <span>Parceiros (CRM)</span></a>
        <a href="#carrinhos-salvos" class="nav-item"><i class="fas fa-shopping-basket"></i> <span>Carrinhos Salvos</span></a>

        
        <div class="nav-section-label">GESTÃO</div>
        <a href="#financeiro" class="nav-item"><i class="fas fa-wallet"></i> <span>Financeiro</span></a>
        <a href="#relatorios" class="nav-item"><i class="fas fa-chart-line"></i> <span>Relatórios & Notas</span></a>

        <div class="nav-section-label">SISTEMA</div>
        <a href="#comunidade" class="nav-item"><i class="fas fa-comments"></i> <span>Comunidade</span></a>
        <a href="#config" class="nav-item"><i class="fas fa-cogs"></i> <span>Configurações</span></a>

    </div>

    <button class="toggle-btn" onclick="toggleSidebar()">
        <i class="fas fa-chevron-left" id="toggle-icon"></i>
    </button>
    

    
</div>


    <div class="main-content" id="main-content">
        
<header class="top-header">
    <div class="header-left">
        <div class="header-title">
            <h1 id="current-page-title">Dashboard</h1>
        </div>
    </div>

    <div class="header-right">
        <div class="notification-container">
            <i class="fas fa-bell bell-icon" id="bell-icon" onclick="toggleAlertsWindow(event)"></i>
            <div class="alerts-floating-window" id="alerts-floating-window">
                <div class="alerts-header">
                    <h4>Notificações</h4>
                    <button class="clear-alerts-btn" onclick="clearAllAlerts()">Limpar</button>
                </div>
                <ul id="alerts-dropdown-list"></ul>
            </div>
        </div>
    </div>
</header>

        

        <section id="dashboard" class="content-section">
            <div class="metric-cards-container metrics-grid">
                <div class="card metric-card green-card">
                    <div class="card-content">
                        <p class="card-label">Estoque Total de Itens</p>
                        <span class="card-value" id="total-stock-items">0</span>
                    </div>
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="card metric-card purple-card">
                    <div class="card-content">
                        <p class="card-label">Total de Produtos</p>
                        <span class="card-value" id="total-products">0</span>
                    </div>
                    <i class="fas fa-box-open"></i>
                </div>
                <div class="card metric-card red-card">
                    <div class="card-content">
                        <p class="card-label">Produtos Estoque Baixo</p>
                        <span class="card-value" id="low-stock-count">0</span>
                    </div>
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="card metric-card blue-card">
                    <div class="card-content">
                        <p class="card-label">Vendas Hoje</p>
                        <span class="card-value" id="sales-today">R$ 0,00</span>
                    </div>
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>

            <div class="dashboard-secondary-area charts-grid">
                <div class="card chart-card">
                    <h4 class="card-title">Análise de Vendas (Últimos 30 Dias)</h4>
                    <div class="chart-container">
                        <canvas id="daily-sales-chart"></canvas> 
                    </div>
                </div>
                
                <div class="card chart-card">
                    <h4 class="card-title">Alerta de Estoque</h4>
                    <ul class="alert-list" id="dashboard-alert-list">
                        <li>Nenhum alerta de estoque baixo.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="produtos" class="content-section" style="display: none;">
            <div class="tabs">
                <button class="tab-button active" data-tab-content="product-list-tab"><i class="fas fa-clipboard-list"></i> Lista de Produtos</button>
                <button class="tab-button" data-tab-content="product-form-tab"><i class="fas fa-plus-circle"></i> Cadastrar/Editar</button>
            </div>

            
            <div id="product-list-tab" class="tab-content active">
                <div class="card">
                    <h3 class="card-title">Estoque Atual</h3>
                    <div class="search-toolbar" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; background: var(--color-bg-secondary); padding: 10px; border-radius: 8px; border: 1px solid var(--color-border); width: 100%; box-sizing: border-box;">
    
    <div style="flex-grow: 1; position: relative;">
        <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #888;"></i>
        
        <input type="text" id="universal-search" 
               placeholder="Pesquisar produto, código, nota..." 
               style="width: 100%; height: 42px; padding: 0 40px 0 35px; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-bg-primary); color: var(--color-text-primary); font-size: 1rem;"
               oninput="aplicarFiltrosAvancados()">
        
        <i class="fas fa-times-circle" 
           onclick="limparBuscaProdutos()"
           style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #666; cursor: pointer; display: none;" 
           id="clear-search-btn"></i>
    </div>

    <div style="flex-shrink: 0; width: 150px;">
        <select id="sort-order" 
                style="width: 100%; height: 42px; padding: 0 10px; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-bg-primary); color: var(--color-text-primary); cursor: pointer; font-size: 0.9rem;"
                onchange="aplicarFiltrosAvancados()">
            <option value="nome-asc">A-Z (Nome)</option>
            <option value="nome-desc">Z-A (Nome)</option>
            <option value="data-entrada">Últimas Entradas</option> <option value="custo-asc">Menor Custo</option>
            <option value="custo-desc">Maior Custo</option>
            <option value="estoque-asc">Menor Estoque</option>
            <option value="estoque-desc">Maior Estoque</option>
        </select>
    </div>
</div>              <div class="table-responsive">
                        <table class="data-table" id="product-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Categoria</th>
                                    <th>Preço (R$)</th>
                                    <th>Estoque</th>
                                    <th>Mínimo</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            

        <div id="product-form-tab" class="tab-content" style="display: none;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 class="card-title" id="form-title" style="margin:0;">Novo Produto> </h3>
        
        <div style="display: flex; gap: 10px;">
            <button type="button" id="cancel-edit-btn" class="submit-btn delete-btn" style="display:none;" onclick="resetProductForm()">
                Cancelar
            </button>
            <button type="button" id="submit-btn" onclick="document.getElementById('main-product-form').dispatchEvent(new Event('submit', {cancelable: true}))" class="submit-btn blue-btn">
                <i class="fas fa-save"></i> Salvar Produto
            </button>
        </div>
    </div>

    <form id="main-product-form" class="product-form" onsubmit="handleProductForm(event)">
        <input type="hidden" id="product-id" name="id">

        <div class="layout-form-split">
            
            <div>
                <div class="modern-section">
                    <div class="modern-header"><i class="fas fa-info-circle"></i> Informações Básicas</div>
                    
                    <div class="input-wrapper" style="margin-bottom: 15px;">
                        <label>Nome do Produto *</label>
                        <input type="text" id="nome" class="modern-input" required placeholder="Ex: Coca Cola 2L">
                    </div>

                    <div class="grid-row-2">
                        <div class="input-wrapper">
                            <label>Código de Barras (EAN)</label>
                            <input type="text" id="codigoBarras" class="modern-input" placeholder="Bipe ou digite...">
                        </div>
                        <div class="input-wrapper">
                            <label style="color:#0A84FF;">Cód. Nota / Ref (cProd)</label>
                            <input type="text" id="cProd" class="modern-input" placeholder="Cód. do Fornecedor">
                        </div>
                    </div>

                    <div class="grid-row-2">
                        <div class="input-wrapper">
                            <label>Categoria</label>
                            <select id="categoria" class="modern-input"></select>
                        </div>
                        <div class="input-wrapper">
                            <label>Fornecedor</label>
                            <select id="prodFornecedor" class="modern-input"></select>
                        </div>
                    </div>
                    
                    <div class="input-wrapper">
                        <label>Estabelecimento</label>
                        <select id="prodEstabelecimento" class="modern-input"></select>
                    </div>
                </div>

                <div class="modern-section">
                    <div class="modern-header"><i class="fas fa-boxes"></i> Estoque & Fiscal</div>
                    
                    <div class="grid-row-3">
                        <div class="input-wrapper">
                            <label>Estoque Atual *</label>
                            <input type="number" id="quantidade" class="modern-input" required min="0" style="font-weight:bold; color:#fff;">
                        </div>
                        <div class="input-wrapper">
                            <label>Mínimo</label>
                            <input type="number" id="minimo" class="modern-input" placeholder="Alerta">
                        </div>
                        <div class="input-wrapper">
                            <label>Unidade</label>
                            <select id="unidade" class="modern-input">
                                <option value="UN">UN (Unidade)</option>
                                <option value="CX">CX (Caixa)</option>
                                <option value="KG">KG (Quilo)</option>
                                <option value="L">L (Litro)</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid-row-2">
                        <div class="input-wrapper">
                            <label>NCM (Fiscal)</label>
                            <input type="text" id="ncm" class="modern-input" placeholder="0000.00.00">
                        </div>
                        <div class="input-wrapper">
                            <label>Localização</label>
                            <input type="text" id="localizacao" class="modern-input" placeholder="Corredor B">
                        </div>
                    </div>
                    
                    <input type="hidden" id="maximo" value="0">
                    <input type="hidden" id="leadTime" value="0">
                </div>
            </div>

            <div>
                
                <div class="modern-section" style="padding: 15px;">
                    <div class="modern-header"><i class="fas fa-camera"></i> Foto do Produto</div>
                    
                    <label class="upload-area" for="prodImagemFile">
                        <img id="form-image-preview" class="image-preview-img" src="" alt="">
                        
                        <div id="form-image-placeholder" class="upload-placeholder">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <div>Clique para enviar</div>
                            <small style="font-size:0.7rem;">JPG/PNG (Max 800px)</small>
                        </div>

                        <input type="file" id="prodImagemFile" accept="image/*" style="display:none" onchange="converterImagemParaBase64(this)">
                        <input type="hidden" id="prodImagem">
                    </label>

                    <button type="button" class="submit-btn delete-btn" style="width:100%; margin-top:10px; padding: 5px; font-size:0.8rem;" onclick="limparImagemForm()">
                        <i class="fas fa-trash"></i> Remover Foto
                    </button>
                </div>

                <div class="modern-section price-card">
                    <div class="modern-header" style="color:#0A84FF; border-color:#0A84FF;">
                        <i class="fas fa-dollar-sign"></i> Precificação
                    </div>

                    <div class="grid-row-2">
                        <div class="input-wrapper">
                            <label>Custo (R$)</label>
                            <input type="number" id="custo" class="modern-input" step="0.01" oninput="calcularPrecificacao()">
                        </div>
                        <div class="input-wrapper">
                            <label>Frete/Outros</label>
                            <input type="text" id="prodFrete" class="modern-input" placeholder="0,00" oninput="calcularPrecificacao()">
                        </div>
                    </div>

                    <div class="grid-row-2">
                        <div class="input-wrapper">
                            <label>Markup (x)</label>
                            <input type="number" id="prodMarkup" class="modern-input" step="0.01" value="2.0" oninput="calcularPrecificacao()">
                        </div>
                        <div class="input-wrapper">
                            <label>Sugerido</label>
                            <input type="text" id="precoSugeridoDisplay" class="modern-input" readonly style="color:#888; border:none; background:transparent;">
                        </div>
                    </div>

                    <hr style="border:0; border-top:1px dashed #444; margin: 15px 0;">

                    <div class="input-wrapper" style="position: relative;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <label style="color:#30D158;">PREÇO FINAL *</label>
                            
                            <div style="display:flex; align-items:center; gap:5px;">
                                <span id="label-mode" style="font-size:0.7rem; color:#aaa;">Auto</span>
                                <label class="toggle-switch" style="transform: scale(0.7);">
                                    <input type="checkbox" id="autoMarkupSwitch" onchange="calcularPrecificacao()" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <span class="currency-symbol">R$</span>
                        <input type="text" id="preco" name="preco" class="modern-input big-price" required oninput="calcularPrecificacao('preco')" placeholder="0,00">
                    </div>

                    <div style="display:flex; justify-content:space-between; margin-top: 10px; font-size: 0.8rem; color: #aaa;">
                        <span>Lucro: <strong id="spanLucro" style="color:#30D158">R$ 0,00</strong></span>
                        <span><strong id="spanMargem">0%</strong></span>
                    </div>
                </div>

            </div> </div> </form>
        </div>
        
        </section>

        <section id="vendas" class="content-section" style="display: none;">
            <div class="pdv-layout pdv-container">
                <div class="pdv-left-panel">
                    <div class="card pdv-card">
                        <h3 class="card-title">Produtos</h3>
                        <div class="pdv-search">
                            <input type="text" id="pdv-search-input" placeholder="Buscar produto por nome ou Código..." class="search-input" onkeyup="filterPdvProducts()">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="products-grid" id="products-grid">
                        </div>
                    </div>
                </div>

               <div class="pdv-right-panel" id="pdv-right-panel">
    <div class="card cart-card">
        <h3 class="card-title">Carrinho de Compras</h3>
        
        <ul class="cart-items-list" id="cart-items-list">
        </ul>
        
        <!-- DIV CART-ACTIONS CORRETAMENTE FECHADA -->
        <div class="cart-actions">
            <button class="submit-btn delete-btn" onclick="clearCart()"><i class="fas fa-trash-alt"></i> Limpar</button>
            <button class="submit-btn purple-btn" onclick="saveCurrentCart()"><i class="fas fa-save"></i> Salvar Carrinho</button>
        </div>

        <div class="cart-totals">
            <p>Subtotal: <span id="cart-subtotal">R$ 0,00</span></p>
            <p class="total">Total: <span id="cart-total">R$ 0,00</span></p>
        </div>

        <button class="submit-btn finaliza-venda-btn green-btn" onclick="checkout()"><i class="fas fa-check-circle"></i> Finalizar Venda</button>
    </div>
</div>
            </div>
        </section>

<section id="parceiros" class="content-section" style="display: none;">
    
    <div class="metric-cards-container" style="margin-bottom: 20px;">
        <div class="metric-card blue-card">
            <div>
                <span class="card-label">Carteira Ativa</span>
                <span class="card-value" id="crm-active-count">0</span>
                <small>Clientes com compra < 60d</small>
            </div>
            <i class="fas fa-users"></i>
        </div>
        <div class="metric-card purple-card">
            <div>
                <span class="card-label">Ticket Médio (LTM)</span>
                <span class="card-value" id="crm-ticket-avg">R$ 0,00</span>
                <small>Last Twelve Months</small>
            </div>
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="metric-card red-card">
            <div>
                <span class="card-label">Risco de Concentração</span>
                <span class="card-value" id="crm-concentration">0%</span>
                <small>Faturamento no Top 5</small>
            </div>
            <i class="fas fa-balance-scale-right"></i>
        </div>
        <div class="metric-card orange-card">
            <div>
                <span class="card-label">Churn (Perdidos)</span>
                <span class="card-value" id="crm-churn-count">0</span>
                <small>Sem compra > 90d</small>
            </div>
            <i class="fas fa-user-slash"></i>
        </div>
    </div>

    <div class="config-grid" style="margin-bottom: 20px;">
        
        <div class="card">
            <h3 class="card-title">Radar de Risco & Oportunidade</h3>
            <ul id="crm-radar-list" style="list-style: none; padding: 0; font-size: 0.9rem; color: var(--color-text-secondary);">
                <li style="padding: 10px; border-bottom: 1px dashed #333;">Calculando inteligência...</li>
            </ul>
        </div>

        <div class="card">
            <h3 class="card-title">Próximas Ações (CRM)</h3>
            <ul id="crm-actions-list" style="list-style: none; padding: 0; font-size: 0.9rem;">
                <li style="padding: 10px; border-bottom: 1px dashed #333; display:flex; justify-content:space-between; align-items:center;">
    <span><i class="fas fa-birthday-cake" style="color:#FF4081"></i> Aniversariantes</span>
    <button class="badge badge-info" style="border:none; cursor:pointer;" onclick="abrirMuralAniversarios()">
        <i class="fas fa-calendar-alt"></i> Ver Mural
    </button>
</li>
                <li style="padding: 10px; border-bottom: 1px dashed #333; display:flex; justify-content:space-between;">
                    <span><i class="fas fa-sync-alt" style="color:#0A84FF"></i> Reativação (Inativos)</span>
                    <span id="crm-reactivation-count" class="badge badge-warning">0</span>
                </li>
            </ul>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-button active" data-tab-content="tab-clientes">
            <i class="fas fa-briefcase"></i> Clientes (ABC)
        </button>
        <button class="tab-button" data-tab-content="tab-fornecedores">
            <i class="fas fa-truck"></i> Fornecedores (Score)
        </button>
    </div>

    <div id="tab-clientes" class="tab-content active">
    <div class="card">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:center;">
            <h3 class="card-title" style="margin:0;">Carteira de Clientes</h3>
            <button class="submit-btn blue-btn" onclick="abrirModalCliente()">
                <i class="fas fa-plus"></i> Novo Cliente
            </button>
        </div>
        
        <div class="table-responsive">
            <table class="data-table" id="clientes-table">
                <thead>
        <tr>
            <th>Status</th>
            <th>Cliente / Documento</th>
            <th>Contato</th> <th>Performance (LTV)</th> <th>Ações</th>
        </tr>
    </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

    <div id="tab-fornecedores" class="tab-content" style="display: none;">
    <div class="card">
        <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:center;">
            <h3 class="card-title" style="margin:0;">Base de Fornecedores</h3>
            <button class="submit-btn green-btn" onclick="abrirModalFornecedor()">
                <i class="fas fa-plus"></i> Novo Fornecedor
            </button>
        </div>
        <div class="table-responsive">
            <table class="data-table" id="fornecedores-table">
                <thead>
        <tr>
            <th>Status</th>
            <th>Fornecedor / CNPJ</th>
            <th>Contato</th> <th>Vínculos</th>
            <th>Ações</th>
        </tr>
    </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>
</section>

<div id="modal-form-cliente" class="modal-overlay" style="display:none; z-index:3005;">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y:auto;">
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 15px; display:flex; justify-content:space-between;">
            <h3 id="titulo-modal-cliente" style="margin:0;"><i class="fas fa-user-plus"></i> Cadastro de Cliente</h3>
            <button class="close-modal-btn" onclick="fecharModalCliente()"><i class="fas fa-times"></i></button>
        </div>
        
        <form onsubmit="handleClientForm(event)">
            <input type="hidden" id="client-id">
            
            <h5 style="color:var(--color-accent-blue); border-bottom:1px solid #333; margin-bottom:10px;">Dados Principais</h5>
            <div class="form-grid" style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:10px; margin-bottom:10px;">
                <div><label>Nome Completo / Razão Social *</label><input type="text" id="cliNome" required class="config-input"></div>
                <div><label>Tipo</label><select id="cliTipo" class="config-input"><option value="PF">Pessoa Física</option><option value="PJ">Pessoa Jurídica</option></select></div>
                <div><label>Status</label><select id="cliStatusManual" class="config-input"><option value="Ativo">Ativo</option><option value="Bloqueado">Bloqueado</option></select></div>
            </div>

            <div class="form-grid" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:10px;">
                <div><label>CPF / CNPJ</label><input type="text" id="cliDoc" class="config-input" oninput="mascaraCpfCnpj(this)"></div>
                <div><label>RG / Inscrição Estadual</label><input type="text" id="cliIe" class="config-input"></div>
                <div><label>Data Nasc. / Fundação</label><input type="date" id="cliNasc" class="config-input"></div>
            </div>

            <div class="form-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                <div><label>E-mail Principal</label><input type="email" id="cliEmail" class="config-input"></div>
                <div><label>Celular / WhatsApp</label><input type="text" id="cliTel" class="config-input" oninput="mascaraTelefone(this)"></div>
            </div>

            <h5 style="color:var(--color-accent-blue); border-bottom:1px solid #333; margin:15px 0 10px 0;">Endereço</h5>
            <div class="form-grid" style="display:grid; grid-template-columns: 1fr 3fr; gap:10px; margin-bottom:10px;">
                <div><label>CEP</label><input type="text" id="cliCep" class="config-input" placeholder="00000-000"></div>
                <div><label>Logradouro (Rua, Av...)</label><input type="text" id="cliRua" class="config-input"></div>
            </div>
            <div class="form-grid" style="display:grid; grid-template-columns: 1fr 2fr 1fr 1fr; gap:10px; margin-bottom:10px;">
                <div><label>Número</label><input type="text" id="cliNum" class="config-input"></div>
                <div><label>Bairro</label><input type="text" id="cliBairro" class="config-input"></div>
                <div><label>Cidade</label><input type="text" id="cliCidade" class="config-input"></div>
                <div><label>UF</label><input type="text" id="cliUf" class="config-input" maxlength="2" style="text-transform:uppercase;"></div>
            </div>

            <h5 style="color:var(--color-accent-green); border-bottom:1px solid #333; margin:15px 0 10px 0;">Financeiro</h5>
            <div class="form-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                <div><label>Limite de Crédito (R$)</label><input type="number" id="cliLimite" class="config-input" step="0.01"></div>
                <div><label>Observações</label><input type="text" id="cliObs" class="config-input"></div>
            </div>

            <div class="modal-actions" style="display:flex; justify-content:flex-end; gap:10px;">
                <button type="button" class="submit-btn delete-btn" onclick="fecharModalCliente()">Cancelar</button>
                <button type="submit" class="submit-btn blue-btn">Salvar Ficha</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-form-fornecedor" class="modal-overlay" style="display:none; z-index:3005;">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y:auto;">
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 15px; display:flex; justify-content:space-between;">
    <h3 id="titulo-modal-fornecedor" style="margin:0;"><i class="fas fa-truck"></i> Cadastro de Fornecedor</h3>
    <button class="close-modal-btn" onclick="fecharModalFornecedor()"><i class="fas fa-times"></i></button>
</div>
        
        <form onsubmit="handleSupplierForm(event)">
    <input type="hidden" id="supp-id">
    
    <h5 style="color:var(--color-accent-purple); border-bottom:1px solid #333; margin-bottom:10px;">Dados Empresariais</h5>
    <div class="form-grid" style="display:grid; grid-template-columns: 2fr 1fr; gap:10px; margin-bottom:10px;">
        <div><label>Razão Social *</label><input type="text" id="suppNome" required class="config-input"></div>
        <div><label>Nome Fantasia</label><input type="text" id="suppFantasia" class="config-input"></div>
    </div>

    <div class="form-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
        <div><label>CNPJ</label><input type="text" id="suppCnpj" class="config-input" oninput="mascaraCnpj(this)"></div>
        <div><label>Inscrição Estadual</label><input type="text" id="suppIe" class="config-input"></div>
    </div>

    <h5 style="color:var(--color-accent-purple); border-bottom:1px solid #333; margin:15px 0 10px 0;">Endereço Completo</h5>
    <div class="form-grid" style="display:grid; grid-template-columns: 1fr 3fr; gap:10px; margin-bottom:10px;">
        <div><label>CEP</label><input type="text" id="suppCep" class="config-input" placeholder="00000-000"></div>
        <div><label>Logradouro (Rua, Av...)</label><input type="text" id="suppRua" class="config-input"></div>
    </div>
    <div class="form-grid" style="display:grid; grid-template-columns: 1fr 2fr 1fr 1fr; gap:10px; margin-bottom:10px;">
        <div><label>Número</label><input type="text" id="suppNum" class="config-input"></div>
        <div><label>Bairro</label><input type="text" id="suppBairro" class="config-input"></div>
        <div><label>Cidade</label><input type="text" id="suppCidade" class="config-input"></div>
        <div><label>UF</label><input type="text" id="suppUf" class="config-input" maxlength="2" style="text-transform:uppercase;"></div>
    </div>

    <h5 style="color:var(--color-accent-purple); border-bottom:1px solid #333; margin:15px 0 10px 0;">Contato & Pagamento</h5>
    <div class="form-grid" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:10px;">
        <div><label>Nome Vendedor</label><input type="text" id="suppContatoNome" class="config-input"></div>
        <div><label>Telefone/Zap</label><input type="text" id="suppTel" class="config-input" oninput="mascaraTelefone(this)"></div>
        <div><label>Prazo (Dias)</label><input type="number" id="suppPrazo" class="config-input"></div>
    </div>
    <div class="form-group" style="margin-bottom:10px;"><label>E-mail Comercial</label><input type="email" id="suppEmail" class="config-input"></div>

    <div class="modal-actions" style="display:flex; justify-content:flex-end; gap:10px;">
        <button type="button" class="submit-btn delete-btn" onclick="fecharModalFornecedor()">Cancelar</button>
        <button type="submit" class="submit-btn green-btn">Salvar Ficha</button>
    </div>
</form>
    </div>
</div>

<div id="partner-details-modal" class="modal-overlay" style="display:none; z-index:3000;">
    <div class="modal-content" style="max-width: 700px; padding:0; overflow:hidden;">
        <div style="padding:15px; border-bottom:1px solid var(--color-border); display:flex; justify-content:space-between; align-items:center; background:var(--color-bg-secondary);">
            <h3 style="margin:0;"><i class="fas fa-id-card"></i> Ficha Técnica</h3>
            <button class="close-modal-btn" onclick="document.getElementById('partner-details-modal').style.display='none'"><i class="fas fa-times"></i></button>
        </div>
        <div id="partner-modal-content" style="max-height:80vh; overflow-y:auto;"></div>
        
        <div style="padding:15px; border-top:1px solid var(--color-border); text-align:right;">
            <button class="submit-btn blue-btn" onclick="document.getElementById('partner-details-modal').style.display='none'">Fechar</button>
        </div>
    </div>
</div>

<div id="modal-mural-aniversarios" class="modal-overlay" style="display:none; z-index:4000;">
    <div class="modal-content" style="max-width: 600px; max-height: 80vh; display:flex; flex-direction:column;">
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 15px; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;"><i class="fas fa-birthday-cake" style="color:#FF4081;"></i> Aniversariantes</h3>
            <button class="close-modal-btn" onclick="document.getElementById('modal-mural-aniversarios').style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div style="flex:1; overflow-y:auto;">
            <div style="margin-bottom:15px; text-align:center;">
                <select id="filtro-mes-niver" onchange="renderizarMuralAniversarios()" style="padding:8px; border-radius:5px; background:var(--color-bg-tertiary); color:white; border:1px solid var(--color-border);">
                    <option value="todos">Todos os Meses</option>
                    <option value="0">Janeiro</option>
                    <option value="1">Fevereiro</option>
                    <option value="2">Março</option>
                    <option value="3">Abril</option>
                    <option value="4">Maio</option>
                    <option value="5">Junho</option>
                    <option value="6">Julho</option>
                    <option value="7">Agosto</option>
                    <option value="8">Setembro</option>
                    <option value="9">Outubro</option>
                    <option value="10">Novembro</option>
                    <option value="11">Dezembro</option>
                </select>
            </div>
            <div id="grid-aniversariantes" class="birthday-grid"></div>
        </div>
    </div>
</div>





        <section id="carrinhos-salvos" class="content-section saved-carts-section" style="display: none;">
            <div class="card">
                <h3 class="card-title">Carrinhos de Venda Salvos</h3>
                    <div class="saved-carts-grid" id="saved-carts-list">
	                </div>
            </div>
        </section>

        <section id="financeiro" class="content-section" style="display: none;">
    <div class="tabs">
        <button class="tab-button active" data-tab-content="fin-dashboard">
            <i class="fas fa-chart-line"></i> Visão Geral & DRE
        </button>
        <button class="tab-button" data-tab-content="fin-lancamentos">
            <i class="fas fa-exchange-alt"></i> Lançamentos (Despesas)
        </button>
        <button class="tab-button" data-tab-content="fin-analise">
            <i class="fas fa-brain"></i> Análise ABC & Simulações
        </button>
    </div>

    <div id="fin-dashboard" class="tab-content active">
        <div class="metric-cards-container">
            <div class="metric-card green-card">
                <div>
                    <span class="card-label">Receita Bruta (Mês)</span>
                    <span class="card-value" id="dre-receita">R$ 0,00</span>
                </div>
                <i class="fas fa-arrow-up"></i>
            </div>
            <div class="metric-card red-card">
                <div>
                    <span class="card-label">Custos + Despesas</span>
                    <span class="card-value" id="dre-custos">R$ 0,00</span>
                </div>
                <i class="fas fa-arrow-down"></i>
            </div>
            <div class="metric-card blue-card">
                <div>
                    <span class="card-label">Lucro Líquido Real</span>
                    <span class="card-value" id="dre-lucro">R$ 0,00</span>
                </div>
                <i class="fas fa-wallet"></i>
            </div>
            <div class="metric-card purple-card">
                <div>
                    <span class="card-label">Margem Líquida</span>
                    <span class="card-value" id="dre-margem">0%</span>
                </div>
                <i class="fas fa-percent"></i>
            </div>
        </div>

        <div class="card">
            <h3 class="card-title">D.R.E. Gerencial (Tempo Real)</h3>
            <div class="table-responsive">
                <table class="data-table" id="dre-table" style="font-family: monospace; font-size: 1.1rem;">
                    <thead>
                        <tr>
                            <th>Estrutura</th>
                            <th style="text-align:right">Valor (R$)</th>
                            <th style="text-align:right">Análise Vertical (%)</th>
                        </tr>
                    </thead>
                    <tbody id="dre-tbody">
                        </tbody>
                </table>
            </div>
            <div style="margin-top: 15px; text-align: right;">
                <button class="submit-btn purple-btn" onclick="generatePDF('profit-report')">
                    Imprimir DRE
                </button>
            </div>
        </div>
    </div>

    <div id="fin-lancamentos" class="tab-content" style="display: none;">
    <div class="config-grid">
        
        <div class="card">
            <h3 class="card-title">Registrar Nova Despesa</h3>
            <form onsubmit="handleExpenseForm(event)">
                <div class="form-group">
                    <label>Descrição</label>
                    <input type="text" id="desc-despesa" required placeholder="Ex: Aluguel, Luz...">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="valor-despesa" required step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="cat-despesa">
                            <option value="Operacional">Operacional (Fixo)</option>
                            <option value="Pessoal">Pessoal / Salários</option>
                            <option value="Impostos">Impostos / Taxas</option>
                            <option value="Marketing">Marketing / Vendas</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Data de Competência</label>
                    <input type="date" id="data-despesa" required>
                </div>
                <button type="submit" class="submit-btn delete-btn" style="width: 100%;">Registrar Saída</button>
            </form>
        </div>

        <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--color-border); padding-bottom: 15px;">
        <h3 class="card-title" style="margin:0;">Histórico de Despesas</h3>
        
        <button type="button" class="submit-btn purple-btn" onclick="imprimirTabelaDespesas()">
            Imprimir
        </button>
    </div>

    <div style="background-color: var(--color-bg-primary); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--color-border);">
    <h5 style="margin-bottom: 10px; color: var(--color-text-secondary); display:flex; align-items:center; gap:5px;">
        <i class="fas fa-filter"></i> Filtro de Despesas
    </h5>
    
    <div style="display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 140px;">
            <label style="font-size: 0.8rem; color:#aaa; margin-bottom:5px; display:block;">Data Inicial:</label>
            <input type="date" id="busca-fin-inicio" style="width: 100%; padding: 10px; background:var(--color-bg-tertiary); border:1px solid var(--color-border); color:#fff; border-radius:5px;">
        </div>

        <div style="flex: 1; min-width: 140px;">
            <label style="font-size: 0.8rem; color:#aaa; margin-bottom:5px; display:block;">Data Final:</label>
            <input type="date" id="busca-fin-fim" style="width: 100%; padding: 10px; background:var(--color-bg-tertiary); border:1px solid var(--color-border); color:#fff; border-radius:5px;">
        </div>

        <div style="display:flex; gap:5px;">
            <button type="button" class="submit-btn blue-btn" onclick="filtrarDespesasV2()" style="height: 42px; padding: 0 20px;">
                <i class="fas fa-search"></i> Filtrar
            </button>
            <button type="button" class="submit-btn delete-btn" onclick="resetarFiltroDespesas()" style="height: 42px; padding: 0 15px;" title="Limpar Filtro">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>
</div>

    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
        <table class="data-table" id="expenses-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
    </div>
</div>

    <div id="fin-analise" class="tab-content" style="display: none;">
        <div class="config-grid">
            
            <div class="card">
                <h3 class="card-title">Curva ABC (Produtos Estrela)</h3>
                <p class="config-description">Classe A: Representam 80% do seu faturamento.</p>
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table class="data-table" id="abc-table">
                        <thead>
                            <tr>
                                <th>Classe</th>
                                <th>Produto</th>
                                <th>Faturamento</th>
                                <th>Acumulado</th>
                            </tr>
                        </thead>
                        <tbody id="abc-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="background: linear-gradient(145deg, var(--color-bg-secondary), #1a202c);">
                <h3 class="card-title">Simulador de Futuro</h3>
                <p class="config-description">O que acontece se...</p>
                
                <div class="form-group">
                    <label>Aumentar Vendas em (%):</label>
                    <input type="number" id="sim-vendas-pct" value="10" oninput="runSimulation()">
                </div>
                <div class="form-group">
                    <label>Reduzir Custos Fixos em (%):</label>
                    <input type="number" id="sim-custos-pct" value="5" oninput="runSimulation()">
                </div>

                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h4 style="margin:0; font-size: 0.9rem; color:#aaa;">Resultado Projetado:</h4>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                        <span>Novo Lucro Líquido:</span>
                        <span id="sim-resultado" style="font-size: 1.4rem; font-weight: bold; color: var(--color-accent-green);">R$ 0,00</span>
                    </div>
                </div>
                
                <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                    <button class="submit-btn blue-btn" style="width:100%; opacity: 0.6; cursor: not-allowed;" title="Requer API Bancária">
                        <i class="fas fa-university"></i> Integração Bancária (Em Breve)
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="relatorios" class="content-section" style="display: none;">
    
    <div class="tabs" style="margin-bottom: 20px;">
        <button class="tab-button active" data-tab-content="rel-vendas">
            <i class="fas fa-search"></i> Pesquisa de Vendas
        </button>
        <button class="tab-button" data-tab-content="rel-estoque" onclick="calcularKPIsEstoque()">
            <i class="fas fa-boxes"></i> Inteligência de Estoque (GMROI)
        </button>
        <button class="tab-button" data-tab-content="rel-margem" onclick="calcularAnaliseMargem()">
            <i class="fas fa-chart-pie"></i> Análise de Margens
        </button>
    </div>

    <div id="rel-vendas" class="tab-content active">
        
        <div class="metric-cards-container" style="margin-bottom: 20px;">
    
    <div class="metric-card blue-card" style="padding: 15px;">
        <div>
            <span class="card-label">Valor de Estoque (Lucro)</span>
            <span class="card-value" id="exec-estoque-custo">R$ 0,00</span>
        </div>
        <i class="fas fa-boxes"></i>
    </div>

    <div class="metric-card green-card" style="padding: 15px;">
        <div>
            <span class="card-label">Ticket Médio (Mês)</span>
            <span class="card-value" id="exec-ticket">R$ 0,00</span>
        </div>
        <i class="fas fa-receipt"></i>
    </div>

    <div class="metric-card purple-card" style="padding: 15px;">
        <div>
            <span class="card-label">Top Cliente (Mês)</span>
            <span class="card-value" id="exec-top-cliente" style="font-size: 1.1rem;">-</span>
        </div>
        <i class="fas fa-crown"></i>
    </div>
</div>

        <div class="card">
            <div class="report-header">
                <h3 class="card-title" style="margin:0;">Detalhamento de Vendas</h3>
                
                <div class="report-controls">
                    <div class="search-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="sales-search-fixed" placeholder="Pesquisar ID, Cliente..." onkeyup="filterSalesTable(this.value)">
                    </div>

                    <button class="submit-btn blue-btn" onclick="abrirModalRelatorio()" style="height: 40px; display:flex; align-items:center;">
                        <i class="fas fa-calendar-alt"></i> Filtrar Data
                    </button>
                    
                    <button id="btn-clear-relatorio" class="submit-btn delete-btn" onclick="limparFiltroRelatorio()" style="display:none; height: 40px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="data-table" id="sales-report-table">
                    <thead>
                        <tr>
                            <th>ID Venda</th>
                            <th>Data</th>
                            <th>Total (R$)</th>
                            <th>Pagamento</th>
                            <th>Itens</th>
                            <th>Cliente</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="sales-table-body">
                        </tbody>
                </table>
            </div>
        </div>

         <div class="card" >
    <div class="report-header">
        <h3 class="card-title" style="margin:0;">
            Relatório de Entradas (Notas Fiscais)
        </h3>
        
        <div class="report-controls">
            <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="invoices-search" placeholder="Fornecedor, Nº Nota..." onkeyup="filterInvoicesTable(this.value)">
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="data-table" id="invoices-report-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Nº Nota</th>
                    <th>Fornecedor</th>
                    <th>Itens</th>
                    <th>Valor Total</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="invoices-table-body">
                <tr><td colspan="6" style="text-align:center; padding:20px; color:#888;">Nenhuma nota importada ainda.</td></tr>
            </tbody>
        </table>
    </div>
</div>
    </div>



    <div id="rel-estoque" class="tab-content" style="display: none;">
        <div class="config-grid">
            
            <div class="metric-cards-container" style="grid-column: 1 / -1; margin-bottom: 10px;">
                <div class="metric-card orange-card">
                    <div>
                        <span class="card-label" title="Gross Margin Return on Investment">GMROI (Retorno s/ Estoque)</span>
                        <span class="card-value" id="kpi-gmroi">0.0</span>
                        <small style="color:#aaa;">Meta: > 1.5</small>
                    </div>
                    <i class="fas fa-coins"></i>
                </div>
                <div class="metric-card red-card">
                    <div>
                        <span class="card-label">Custo do Estoque Corrente</span>
                        <span class="card-value" id="kpi-stock-cost">R$ 0,00</span>
                    </div>
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="metric-card blue-card">
                    <div>
                        <span class="card-label">Giro de Estoque (Médio)</span>
                        <span class="card-value" id="kpi-giro">0x / ano</span>
                    </div>
                    <i class="fas fa-sync"></i>
                </div>
            </div>

            <div class="card" style="grid-column: 1 / -1;">
                <h3 class="card-title"><i class="fas fa-exclamation-triangle"></i> Cobertura de Estoque e Risco de Ruptura</h3>
                <p class="config-description">Produtos que vão acabar em breve baseado na média de vendas diária.</p>
                <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                    <table class="data-table" id="ruptura-table">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Estoque Atual</th>
                                <th>Vendas/Dia (Média)</th>
                                <th>Dias de Cobertura</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="ruptura-tbody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="rel-margem" class="tab-content" style="display: none;">
        <div class="config-grid">
            <div class="card">
                <h3 class="card-title">Margem por Categoria</h3>
                <div class="table-responsive">
                    <table class="data-table" id="margem-cat-table">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Receita Total</th>
                                <th>Lucro Bruto</th>
                                <th>Margem %</th>
                            </tr>
                        </thead>
                        <tbody id="margem-cat-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Top Clientes (Rentabilidade)</h3>
                <div class="table-responsive">
                    <table class="data-table" id="margem-cli-table">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Compras</th>
                                <th>Ticket Médio</th>
                                <th>Total Gasto</th>
                            </tr>
                        </thead>
                        <tbody id="margem-cli-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

        

        

        <section id="config" class="content-section" style="display: none;">
            
    <div class="card">
        <h3 class="card-title"><i class="fas fa-cogs"></i> Configurações do Sistema</h3>
        
        <div class="config-tabs">
            <button class="config-tab-button active" data-config-tab="categories">
                <i class="fas fa-tags"></i> Categorias
            </button>
            <button class="config-tab-button" data-config-tab="payments">
                <i class="fas fa-credit-card"></i> Pagamentos
            </button>
            <button class="config-tab-button" data-config-tab="establishments">
                <i class="fas fa-building"></i> Estabelecimentos
            </button>
            <!-- REMOVIDA A ABA GERAIS -->
            <button class="config-tab-button" data-config-tab="backup">
                <i class="fas fa-database"></i> Backup
            </button>

            <button class="config-tab-button" data-config-tab="logs" onclick="renderAuditLogs()">
                <i class="fas fa-history"></i> Ações
            </button>
        </div>

        <!-- ABA CATEGORIAS -->
        <div id="categories-tab" class="config-tab-content active">
            <div class="config-section">
                <h4><i class="fas fa-tags"></i> Gerenciar Categorias</h4>
                <p class="config-description">Adicione, edite ou remova categorias de produtos.</p>
                
                <div class="categories-manager">
                    <div class="categories-list">
                        <h5>Categorias Existentes</h5>
                        <div class="categories-container" id="categories-container">
                            <!-- Categorias serão injetadas aqui -->
                        </div>
                    </div>
                    
                    <div class="category-form">
                        <h5>Adicionar Nova Categoria</h5>
                        <div class="form-group">
                            <input type="text" id="new-category-name" placeholder="Nome da categoria" maxlength="50">
                            <button class="submit-btn blue-btn" onclick="addNewCategory()">
                                <i class="fas fa-plus"></i> Adicionar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABA PAGAMENTOS -->
        <div id="payments-tab" class="config-tab-content">
            <div class="config-section">
                <h4><i class="fas fa-credit-card"></i> Métodos de Pagamento</h4>
                <p class="config-description">Gerencie as formas de pagamento aceitas no PDV.</p>
                
                <div class="payments-manager">
                    <div class="payments-list">
                        <h5>Métodos Ativos</h5>
                        <div class="payments-container" id="payments-container">
                            <!-- Métodos serão injetadas aqui -->
                        </div>
                    </div>
                    
                    <div class="payment-form">
                        <h5>Adicionar Novo Método</h5>
                        <div class="form-group">
                            <input type="text" id="new-payment-name" placeholder="Nome do método" maxlength="30">
                            <button class="submit-btn blue-btn" onclick="addNewPayment()">
                                <i class="fas fa-plus"></i> Adicionar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="establishments-tab" class="config-tab-content">
    <div class="config-section">
        <h4><i class="fas fa-store-alt"></i> Gerenciar Estabelecimentos</h4>
        <p class="config-description">Cadastre suas lojas, filiais ou nichos (Ex: Lanchonete, Loja de Sapatos).</p>
        
        <div class="categories-manager"> <div class="categories-list">
                <h5>Locais Ativos</h5>
                <div class="categories-container" id="establishments-container">
                    </div>
            </div>
            
            <div class="category-form">
                <h5>Novo Local</h5>
                <div class="form-group">
                    <input type="text" id="new-establishment-name" placeholder="Nome do local" maxlength="30">
                    <button id="btn-add-est" class="submit-btn blue-btn" onclick="addNewEstablishment()">
                        <i class="fas fa-plus"></i> Criar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

        <!-- ABA BACKUP CORRIGIDA -->
        <div id="backup-tab" class="config-tab-content">
        <div class="config-grid">

        <div class="config-section">
    <h4><i class="fas fa-file-invoice-dollar"></i> Importar Nota (XML)</h4>
    <p class="config-description">Dê entrada no estoque automaticamente usando o XML da Nota Fiscal Eletrônica.</p>
    
    <div class="config-actions">
        <input type="file" id="xml-input" accept=".xml" style="display: none;" onchange="processarXMLNota(this)">
        
        <button class="submit-btn green-btn" onclick="document.getElementById('xml-input').click()" style="width: 100%;">
            <i class="fas fa-upload"></i> Selecionar Arquivo XML
        </button>
    </div>
</div>    
                
        <div class="config-section">
            <h4><i class="fas fa-download"></i> Exportar Dados</h4>
            <p class="config-description">Faça backup de todos os dados do sistema.</p>
            
            <div class="backup-options">
                <button class="submit-btn blue-btn" onclick="exportData('all')">
                    <i class="fas fa-file-export"></i> Exportar Tudo (JSON)
                </button>
                <button class="submit-btn green-btn" onclick="exportData('products')">
                    <i class="fas fa-boxes"></i> Apenas Produtos
                </button>
                <button class="submit-btn purple-btn" onclick="exportData('sales')">
                    <i class="fas fa-chart-line"></i> Apenas Vendas
                </button>

                <button class="submit-btn blue-btn" onclick="sincronizarHistoricoCompleto()" style="width: 100%;">
                    <i class="fas fa-sync-alt"></i> Sincronizar
                </button>
                
            </div>
        </div>

        <div class="config-section">
    <h4><i class="fas fa-tags"></i> Etiquetas</h4>
    <p class="config-description">Gerar folhas de etiquetas com código de barras para seus produtos.</p>
    
    <div class="config-actions">
        <button class="submit-btn purple-btn" onclick="abrirModalEtiquetas()" style="width: 100%;">
            <i class="fas fa-barcode"></i> Abrir Gerador
        </button>
    </div>
</div>

        <div class="config-section">
            <h4><i class="fas fa-upload"></i> Importar Dados</h4>
            <p class="config-description">Restaure dados de um backup anterior.</p>
            
            <div class="import-options">
            <div class="form-group">
                <label for="arquivo-backup-input">Selecionar arquivo de backup</label>
                <input type="file" id="arquivo-backup-input" accept=".json" class="config-input">
            </div>
            <button class="submit-btn blue-btn" onclick="importData()">
                <i class="fas fa-file-import"></i> Confirmar Importação
            </button>
        </div>
            
            <div class="import-info">
                <small><i class="fas fa-info-circle"></i> Use arquivos JSON exportados deste sistema</small>
            </div>
        </div>

        <div class="config-section">
            <h4><i class="fas fa-file-pdf"></i> Relatórios em PDF</h4>
            <p class="config-description">Gere relatórios profissionais em PDF.</p>
            
            <div class="pdf-options">
    
                <button class="submit-btn red-btn" onclick="generatePDF('sales-report')">
        <i class="fas fa-file-pdf"></i> Relatório de Vendas
    </button>
    
    <button class="submit-btn orange-btn" onclick="generatePDF('inventory-report')">
        <i class="fas fa-clipboard-list"></i> Relatório de Estoque
    </button>
    <button class="submit-btn teal-btn" onclick="generatePDF('profit-report')">
        <i class="fas fa-chart-bar"></i> Relatório de Lucros
    </button>

    
</div>


            
            <div class="pdf-period" style="margin-top: 15px;">
                <label for="pdf-period">Período do relatório:</label>
                <select id="pdf-period" class="config-select">
                    <option value="7">Últimos 7 dias</option>
                    <option value="30" selected>Últimos 30 dias</option>
                    <option value="90">Últimos 3 meses</option>
                    <option value="custom">Personalizado (Escolher Datas)</option> </select>
                </select>
            </div>
        </div>

        <div class="config-section">
            <h4><i class="fas fa-trash"></i> Limpeza</h4>
            <p class="config-description">Gerencie o espaço e performance do sistema.</p>
            
            <div class="cleanup-options">
                <button class="submit-btn delete-btn" onclick="clearOldSales()">
                    <i class="fas fa-broom"></i> Limpar Vendas Antigas
                </button>
                <button class="submit-btn red-btn" onclick="clearAllData()">
                    <i class="fas fa-trash-alt"></i> Limpar Todos os Dados
                </button>
            </div>
            
            <div class="storage-info">
                <h5>Uso de Armazenamento</h5>
                <div class="storage-bar">
                    <div class="storage-used" id="storage-used"></div>
                </div>
                <small id="storage-text">Calculando...</small>
            </div>
        </div>
    </div>
</div>

    </div>

    <div id="logs-tab" class="config-tab-content">
    <div class="config-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h4><i class="fas fa-shield-alt"></i> Auditoria e Segurança</h4>
            <button class="submit-btn blue-btn" onclick="renderAuditLogs()" style="padding:5px 15px; font-size:0.8rem;">
                <i class="fas fa-sync-alt"></i> Atualizar
            </button>
        </div>

        <h5 style="color: #FF453A; border-bottom: 1px solid #FF453A; padding-bottom: 5px; margin-top: 20px;">
            <i class="fas fa-undo"></i> Registro de Estornos (Financeiro)
        </h5>
        <div class="table-responsive" style="max-height: 250px; overflow-y: auto; margin-bottom: 30px; border: 1px solid #FF453A;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 140px;">Data</th>
                        <th style="width: 150px;">Quem fez</th>
                        <th>Motivo / Detalhe</th>
                    </tr>
                </thead>
                <tbody id="audit-estornos-tbody">
                    </tbody>
            </table>
        </div>

        <h5 style="color: var(--color-accent-blue); border-bottom: 1px solid var(--color-accent-blue); padding-bottom: 5px;">
            <i class="fas fa-history"></i> Histórico Geral de Movimentações
        </h5>
        <p class="config-description" style="font-size: 0.8rem;">Mostrando as últimas 100 ações no sistema.</p>
        
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 140px;">Data</th>
                        <th style="width: 120px;">Ação</th>
                        <th style="width: 150px;">Usuário</th>
                        <th>Detalhes</th>
                    </tr>
                </thead>
                <tbody id="audit-geral-tbody">
                    </tbody>
            </table>
        </div>
    </div>
</div>
        </section>
   

    <section id="comunidade" class="content-section" style="display: none;">
    <div class="community-layout">
        
        <div class="community-feed">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 class="card-title">Dúvidas & Sugestões</h3>
                    <button class="submit-btn blue-btn" onclick="abrirModalPostagem()">
                        Nova Postagem
                    </button>
                </div>

                <div class="community-filters">
                    <button class="filter-chip active" onclick="filtrarComunidade('todos')">Todos</button>
                    <button class="filter-chip" onclick="filtrarComunidade('duvida')">🤔 Dúvidas</button>
                    <button class="filter-chip" onclick="filtrarComunidade('sugestao')">💡 Sugestões</button>
                    <button class="filter-chip" onclick="filtrarComunidade('aviso')">📢 Avisos</button>
                </div>

                <div id="community-posts-list" class="posts-container">
                    <div style="text-align:center; padding:40px; color:#666;">
                        <i class="fas fa-spinner fa-spin"></i> Carregando comunidade...
                    </div>
                </div>
            </div>
        </div>

        <div class="community-sidebar">
            
            <div class="card roadmap-card">
                <h3 class="card-title" style="color:var(--color-accent-purple);">O que vem por aí?</h3>
                <p style="font-size:0.85rem; color:#aaa; margin-bottom:15px;">Acompanhe o desenvolvimento das próximas versões.</p>
                
                <div class="roadmap-timeline">
                    
                    <div class="roadmap-item done">
                        <div class="dot"><i class="fas fa-check"></i></div>
                        <div class="content">
                            <strong>Módulo Financeiro</strong>
                            <span>DRE, Despesas e Lucro Real</span>
                        </div>
                    </div>

                    <div class="roadmap-item progress">
                        <div class="dot"><i class="fas fa-tools"></i></div>
                        <div class="content">
                            <strong>Segurança & Logs</strong>
                            <span>Audit Log e Permissões</span>
                            <div class="progress-bar"><div style="width: 60%"></div></div>
                        </div>
                    </div>

                    <div class="roadmap-item planned">
                        <div class="dot"><i class="far fa-circle"></i></div>
                        <div class="content">
                            <strong>Leitor de Código de Barras</strong>
                            <span>Uso via Webcam/Celular</span>
                        </div>
                    </div>

                    <div class="roadmap-item planned">
                        <div class="dot"><i class="far fa-circle"></i></div>
                        <div class="content">
                            <strong>Importação Bancária</strong>
                            <span>Ler extrato OFX/CSV</span>
                        </div>
                    </div>

                </div>
            </div>

            <div class="card" style="background: rgba(10, 132, 255, 0.05); border: 1px dashed var(--color-accent-blue);">
                <h4 style="font-size:1rem; margin-bottom:10px;"><i class="fas fa-info-circle"></i> Regras da Comunidade</h4>
                <ul style="font-size:0.85rem; color:#ccc; padding-left:20px; line-height:1.6;">
                    <li>Seja respeitoso com todos os membros.</li>
                    <li>Antes de perguntar, veja se já não responderam.</li>
                    <li>Sugestões mais votadas sobem no Roadmap!</li>
                </ul>
            </div>

        </div>
    </div>
</section>

<div id="modal-community-post" class="modal-overlay" style="display:none; z-index:5000;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3>Criar Postagem</h3>
            <button class="close-modal-btn" onclick="fecharModalPostagem()"><i class="fas fa-times"></i></button>
        </div>
        <form onsubmit="handleNewCommunityPost(event)">
            <div class="form-group">
                <label>Tipo de Mensagem</label>
                <select id="post-type" class="config-input">
                    <option value="duvida">🤔 Dúvida</option>
                    <option value="sugestao">💡 Sugestão de Funcionalidade</option>
                    <option value="elogio">❤️ Elogio</option>
                </select>
            </div>
            <div class="form-group">
                <label>Título</label>
                <input type="text" id="post-title" class="config-input" placeholder="Resumo do assunto..." required maxlength="60">
            </div>
            <div class="form-group">
                <label>Mensagem</label>
                <textarea id="post-content" class="config-input" rows="4" placeholder="Descreva detalhadamente..." required></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="submit-btn delete-btn" onclick="fecharModalPostagem()">Cancelar</button>
                <button type="submit" class="submit-btn blue-btn">Publicar</button>
            </div>
        </form>
    </div>
</div>

		    
		    <!-- Modal de Pagamento (Novo) -->
		    <div id="payment-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content payment-modal-content">
        <h3><i class="fas fa-credit-card"></i> Finalizar Venda</h3>
        <p>Total a Pagar: <span id="payment-total-display" class="total-amount">R$ 0,00</span></p>
        
        <div id="payment-options-container"></div>
    </div>
</div>
	    <!-- O bloco de script abaixo foi removido (Inclusão Dupla de script.js) -->
    <!-- Modal de Detalhes da Venda -->
    <div id="sale-details-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content sale-details-modal">
        <div class="modal-header">
            <h3><i class="fas fa-receipt"></i> Detalhes da Venda</h3>
            <button class="close-modal-btn" onclick="closeSaleDetails()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="sale-info">
            <div class="sale-meta">
                <div class="meta-item">
                    <span class="meta-label">ID da Venda:</span>
                    <span class="meta-value" id="detail-sale-id">#</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Data/Hora:</span>
                    <span class="meta-value" id="detail-sale-date">-</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Pagamento:</span>
                    <span class="meta-value" id="detail-sale-payment">-</span>
                </div>
                <div class="meta-item total-item">
                    <span class="meta-label">Total:</span>
                    <span class="meta-value total-amount" id="detail-sale-total">R$ 0,00</span>
                </div>
            </div>
        </div>
        
        
        <div class="modal-actions">
            <button class="submit-btn blue-btn" onclick="closeSaleDetails()">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>
    </div>

    <div id="save-cart-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 400px;">
        <h3><i class="fas fa-save"></i> Salvar Carrinho</h3>
        <p style="margin-bottom: 15px; color: #666;">Digite um nome para identificar este carrinho futuramente.</p>
        
        <div class="form-group">
            <label>Nome do Carrinho:</label>
            <input type="text" id="save-cart-client-name" placeholder="Ex: Mesa 10, João, Encomenda..." 
                   style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 5px;">
        </div>

        <div class="modal-actions" style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 150px;">
            <button class="submit-btn delete-btn" onclick="document.getElementById('save-cart-modal').style.display='none'">
                Cancelar
            </button>
            <button class="submit-btn green-btn" onclick="confirmSaveCart()">
                Salvar
            </button>
        </div>
    </div>

    
    
</div>

<div id="custom-alert" class="modal-overlay" style="display: none; z-index: 20000;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div id="alert-icon" style="font-size: 3rem; margin-bottom: 15px;"></div>
        <h3 id="alert-title" style="margin-bottom: 10px;">Atenção</h3>
        <p id="alert-message" style="color: var(--color-text-secondary); margin-bottom: 20px;">Mensagem aqui</p>
        <button class="submit-btn blue-btn" onclick="closeCustomAlert()" style="width: 100%; justify-content: center;">Entendi</button>
    </div>
</div>

<div id="custom-confirm" class="modal-overlay" style="display: none; z-index: 20000;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <i class="fas fa-question-circle" style="font-size: 3rem; color: var(--color-accent-blue); margin-bottom: 15px;"></i>
        <h3 style="margin-bottom: 10px; justify-content: center;">🚨 PERIGO</h3>
        <p id="confirm-message" style="color: var(--color-text-secondary); margin-bottom: 20px;">Essa ação não pode ser desfeita.</p>
        
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="submit-btn delete-btn" onclick="closeCustomConfirm(false)" style="flex: 1; justify-content: center;">Cancelar</button>
            <button class="submit-btn green-btn" id="btn-confirm-yes" style="flex: 1; justify-content: center;">Sim, Confirmar</button>
        </div>
    </div>
</div>

<div id="custom-prompt" class="modal-overlay" style="display: none; z-index: 20000;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <div style="width: 100%; display: flex; justify-content: center; margin-bottom: 15px;">
            <i class="fas fa-keyboard" style="font-size: 3rem; color: var(--color-accent-blue);"></i>
        </div>
        
        <h3 id="prompt-title" style="margin-bottom: 10px; width: 100%; text-align: center;">Digite a informação</h3>
        <p id="prompt-message" style="color: var(--color-text-secondary); margin-bottom: 15px; width: 100%; text-align: center;"></p>
        
        <input type="text" id="prompt-input" class="config-input" style="width: 100%; margin-bottom: 20px; text-align: center; font-size: 1.2rem; padding: 10px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff;" placeholder="..." autocomplete="off" readonly>

        <div style="display: flex; gap: 10px; justify-content: center; width: 100%;">
            <button class="submit-btn delete-btn" onclick="closeCustomPrompt()" style="flex: 1; justify-content: center;">Cancelar</button>
            <button class="submit-btn blue-btn" id="btn-prompt-confirm" style="flex: 1; justify-content: center;">Confirmar</button>
        </div>
    </div>
</div>

<div id="label-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 700px; max-height: 90vh; display: flex; flex-direction: column;">
        
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 15px;">
            <h3>Imprimir Etiquetas</h3>
            <button class="close-modal-btn" onclick="document.getElementById('label-modal').style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div style="margin-bottom: 15px;">
            <input type="text" id="label-search" placeholder="Filtrar produtos..." 
                   onkeyup="filtrarListaEtiquetas()"
                   style="width: 100%; padding: 10px; background: var(--color-bg-tertiary); color: var(--color-text-primary); border: 1px solid var(--color-border); border-radius: 6px;">
        </div>

        <div class="table-responsive" style="flex: 1; overflow-y: auto; border: 1px solid var(--color-border); border-radius: 6px;">
            <table class="data-table" id="label-selection-table">
                <thead>
                    <tr>
                        <th style="width: 40px;"><input type="checkbox" onclick="toggleTodasEtiquetas(this)"></th>
                        <th>Produto</th>
                        <th style="width: 100px;">Qtd. Etiquetas</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>

        <div class="modal-actions" style="margin-top: 20px; border-top: 1px solid var(--color-border); padding-top: 15px;">
            <div style="flex: 1; display: flex; align-items: center; gap: 10px;">
                <label style="font-size: 0.9rem; color: #aaa;">Tamanho do Papel:</label>
                <select id="label-size" style="padding: 8px; border-radius: 4px; background: #222; color: #fff; border: 1px solid #444;">
                    <option value="thermal">Térmica (80mm x 40mm)</option>
                    <option value="a4">Folha A4 (Pimaco)</option>
                </select>
            </div>
            <button class="submit-btn delete-btn" onclick="document.getElementById('label-modal').style.display='none'">Cancelar</button>
            <button class="submit-btn purple-btn" onclick="gerarPDFEtiquetasSelecionadas()">
                <i class="fas fa-print"></i> Gerar PDF
            </button>
        </div>
    </div>
</div>

<div id="date-filter-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 15px;">
            <h3><i class="fas fa-calendar-day"></i> Selecionar Período</h3>
            <button class="close-modal-btn" onclick="closeDateFilterModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="form-group">
            <label>Data Inicial</label>
            <input type="date" id="filter-start-date" style="width: 100%;">
        </div>

        <div class="form-group">
            <label>Data Final</label>
            <input type="date" id="filter-end-date" style="width: 100%;">
        </div>

        <div class="modal-actions" style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
            <button class="submit-btn delete-btn" onclick="limparFiltroVendas()">
                <i class="fas fa-broom"></i> Limpar
            </button>
            <button class="submit-btn green-btn" onclick="aplicarFiltroVendas()">
                <i class="fas fa-check"></i> Aplicar Filtro
            </button>
        </div>
    </div>
</div>
<div id="modal-filtro-vendas" class="modal-overlay" style="display:none; z-index: 3000;">
    <div class="modal-content" style="max-width: 350px; background-color: var(--color-bg-secondary); border: 1px solid var(--color-border);">
        
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin:0; color: var(--color-text-primary);"><i class="fas fa-calendar-day"></i> Período</h3>
            <button class="close-modal-btn" onclick="document.getElementById('modal-filtro-vendas').style.display='none'" style="background:none; border:none; color:var(--color-text-secondary); cursor:pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="form-group" style="margin-bottom: 15px;">
            <label style="display:block; margin-bottom:5px; color: var(--color-text-secondary);">Data Inicial</label>
            <input type="date" id="modal-relatorio-start" style="width: 100%; padding: 10px; background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-primary); border-radius: 5px;">
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label style="display:block; margin-bottom:5px; color: var(--color-text-secondary);">Data Final</label>
            <input type="date" id="modal-relatorio-end" style="width: 100%; padding: 10px; background: var(--color-bg-tertiary); border: 1px solid var(--color-border); color: var(--color-text-primary); border-radius: 5px;">
        </div>

        <div class="modal-actions" style="display: flex; justify-content: flex-end; gap: 10px;">
            <button class="submit-btn delete-btn" onclick="document.getElementById('modal-filtro-vendas').style.display='none'">
                Cancelar
            </button>
            <button class="submit-btn green-btn" onclick="executarFiltroRelatorio()">
                Aplicar Filtro
            </button>
        </div>
    </div>
</div>

<div id="modal-mural-aniversarios" class="modal-overlay" style="display:none; z-index:4000;">
    <div class="modal-content" style="max-width: 600px; max-height: 80vh; display:flex; flex-direction:column;">
        <div class="modal-header" style="border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 15px; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;"><i class="fas fa-birthday-cake" style="color:#FF4081;"></i> Aniversariantes</h3>
            <button class="close-modal-btn" onclick="document.getElementById('modal-mural-aniversarios').style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div style="flex:1; overflow-y:auto;">
            <div style="margin-bottom:15px; text-align:center;">
                <select id="filtro-mes-niver" onchange="renderizarMuralAniversarios()" style="padding:8px; border-radius:5px; background:var(--color-bg-tertiary); color:white; border:1px solid var(--color-border);">
                    <option value="todos">Todos os Meses</option>
                    <option value="0">Janeiro</option>
                    <option value="1">Fevereiro</option>
                    <option value="2">Março</option>
                    <option value="3">Abril</option>
                    <option value="4">Maio</option>
                    <option value="5">Junho</option>
                    <option value="6">Julho</option>
                    <option value="7">Agosto</option>
                    <option value="8">Setembro</option>
                    <option value="9">Outubro</option>
                    <option value="10">Novembro</option>
                    <option value="11">Dezembro</option>
                </select>
            </div>
            <div id="grid-aniversariantes" class="birthday-grid"></div>
        </div>
    </div>
</div>

<div id="product-preview-modal" class="modal-overlay" style="display:none; z-index: 3000;">
    <div class="modal-content" style="max-width: 900px; width: 95%; padding: 0 !important; background: var(--color-bg-secondary); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column;">
        
        <div style="background: var(--color-bg-tertiary); padding: 15px 25px; border-bottom: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin:0; display:flex; align-items:center; gap:10px; font-size: 1.1rem; color: var(--color-text-primary);">
                <i class="fas fa-box-open" style="color: var(--color-accent-blue);"></i> Ficha do Produto
            </h3>
            <button class="close-modal-btn" onclick="document.getElementById('product-preview-modal').style.display='none'">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="preview-grid-container">
            
            <div class="preview-image-side">
                <img id="preview-img" src="" style="display:none;">
                
                <div id="preview-no-img" style="text-align: center; color: #555;">
                    <i class="fas fa-camera" style="font-size: 4rem; margin-bottom: 10px; opacity: 0.5;"></i>
                    <div>Sem Imagem</div>
                </div>

                <div class="floating-price">
                    <span id="preview-price">R$ 0,00</span>
                </div>
            </div>

            <div class="preview-info-side">
                
                <div style="margin-bottom: 20px;">
                    <span id="preview-category" class="badge badge-info" style="margin-bottom: 10px;">GERAL</span>
                    <h2 id="preview-name" style="margin: 5px 0; font-size: 1.4rem; line-height: 1.3; color: var(--color-text-primary);">Nome do Produto</h2>
                    <div style="color: #888; font-size: 0.9rem; margin-top: 5px;">
                        <i class="fas fa-truck"></i> <span id="preview-supplier">Fornecedor não informado</span>
                    </div>
                </div>

                <div style="background: var(--color-bg-tertiary); padding: 15px; border-radius: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; border: 1px solid var(--color-border);">
                    <div>
                        <small style="color:#888; display:block;">EAN (Barras)</small>
                        <div id="preview-ean" style="font-family: monospace; font-size: 1rem; color: #fff;">-</div>
                    </div>
                    <div>
                        <small style="color:#0A84FF; display:block;">Ref / Nota (cProd)</small>
                        <div id="preview-cprod" style="font-family: monospace; font-size: 1rem; font-weight: bold; color: #fff;">-</div>
                    </div>
                </div>

                <h5 style="border-bottom: 1px dashed #444; padding-bottom: 5px; margin-bottom: 15px; color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Logística & Fiscal</h5>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <small style="color:#888; display:block;">Estoque</small>
                        <strong id="preview-stock" style="font-size: 1.1rem; color: #fff;">0 UN</strong>
                    </div>
                    <div>
                        <small style="color:#888; display:block;">Localização</small>
                        <strong id="preview-local" style="color: var(--color-accent-blue);">-</strong>
                    </div>
                    <div>
                        <small style="color:#888; display:block;">NCM</small>
                        <span id="preview-ncm" style="font-family: monospace; color: #fff;">-</span>
                    </div>
                    <div>
                        <small style="color:#888; display:block;">Estabelecimento</small>
                        <span id="preview-estab" style="color: #fff;">-</span>
                    </div>
                </div>

                <div style="background: rgba(48, 209, 88, 0.05); padding: 15px; border-radius: 8px; border: 1px dashed var(--color-accent-green);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <small style="color:#888;">Custo de Compra</small>
                            <div id="preview-cost" style="font-weight: bold; color: #fff;">R$ 0,00</div>
                        </div>
                        <div style="text-align: right;">
                            <small style="color:#888;">Lucro Estimado</small>
                            <div id="preview-profit" style="font-weight: bold; color: var(--color-accent-green); font-size: 1.2rem;">R$ 0,00</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 25px;">
                    <button id="btn-edit-preview" class="submit-btn blue-btn" style="width: 100%; justify-content: center;">
                        <i class="fas fa-pencil-alt"></i> Editar Dados
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

</div>

<div id="bulk-actions-bar" style="position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: #1E2329; border: 1px solid var(--color-accent-blue); padding: 10px 25px; border-radius: 50px; display: flex; align-items: center; gap: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 999; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
    <span style="color: white; font-weight: 600; font-size: 0.9rem;"><span id="bulk-count">0</span> selecionados</span>
    <div style="height: 20px; width: 1px; background: #444;"></div>
    
    <button class="action-btn" onclick="abrirModalBulkEdit()" title="Caneta Mágica (Editar em Massa)" style="color: var(--color-accent-blue); font-size: 1.2rem;">
        <i class="fas fa-magic"></i>
    </button>
    
    <button class="action-btn" onclick="deselecionarTudo()" title="Cancelar Seleção" style="color: var(--color-text-secondary);">
        <i class="fas fa-times"></i>
    </button>
</div>

<div id="bulk-edit-modal" class="modal-overlay" style="display:none; z-index: 3000;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h3><i class="fas fa-magic" style="color: var(--color-accent-blue);"></i> Edição em Massa</h3>
            <button class="close-modal-btn" onclick="document.getElementById('bulk-edit-modal').style.display='none'"><i class="fas fa-times"></i></button>
        </div>
        
        <p style="font-size: 0.9rem; color: #888; margin-bottom: 15px;">
            Alterando <strong id="bulk-modal-count" style="color: white;">0</strong> produtos. <br>
            <em style="font-size: 0.8rem;">(Preencha apenas o que deseja mudar. O que deixar vazio, não será alterado).</em>
        </p>

        <form onsubmit="handleBulkEdit(event)">
            <div class="form-group">
                <label>Nova Categoria</label>
                <select id="bulk-categoria" class="config-input">
                    <option value="">-- Não Alterar --</option>
                    </select>
            </div>

            <div class="form-group">
                <label>Novo Estabelecimento</label>
                <select id="bulk-estabelecimento" class="config-input">
                    <option value="">-- Não Alterar --</option>
                    </select>
            </div>

            <div class="form-group">
                <label>Novo Fornecedor</label>
                <select id="bulk-fornecedor" class="config-input">
                    <option value="">-- Não Alterar --</option>
                    </select>
            </div>

            <div class="modal-actions">
                <button type="button" class="submit-btn delete-btn" onclick="document.getElementById('bulk-edit-modal').style.display='none'">Cancelar</button>
                <button type="submit" class="submit-btn blue-btn">Aplicar Alterações</button>
            </div>
        </form>
    </div>
</div>

<script type="module" src="script.js"></script>
</body>
</html>